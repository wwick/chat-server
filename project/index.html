<!doctype html>
<html>
  <head>
    <title>Module 6</title>

    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font: 13px Helvetica, Arial; }
        #inputs { background: #000; padding: 3px; position: fixed; bottom: 0; width: 100%; } */
        form input { border: 0; padding: 10px; width: 90%; margin-right: .5%; }
        form button { width: 9%; background: rgb(130, 224, 255); border: none; padding: 10px; }
        #messages { list-style-type: none; margin: 0; padding: 0; }
        #messages li { padding: 5px 10px; }
        #messages li:nth-child(odd) { background: #eee; }
      </style>

    <script
      src="http://code.jquery.com/jquery-3.3.1.js"
      integrity="sha256-2Kok7MbOyxpgUVvAk/HJ2jigOSYS2auK4Pfzbm7uH60="
      crossorigin="anonymous"></script>
    <script src="/socket.io/socket.io.js"></script>

  </head>
  <body>
    <ul id="messages"></ul>

    <div id='inputs'>
      <form action="" id="message">
        <input id="m" autocomplete="off" /><button>Send</button>
      </form>

      <form id="name" action="">
          Name: <input type="text" id="username"/><button id="login">Login</button>
        </form>
    
      <form action="" id="group">
          Group Name: <input id="g" autocomplete="off" /> Group Password: <input id="password" autocomplete="off" type="password"/> <button>Group</button>
      </form>
      <button id="delete">Delete Room</button>
    </div>

    <script>
      let username = "";
      $(function () {

        const socket = io();
        let room = 'default';
        //let username = '';

        $('#name').submit(function(e){
          e.preventDefault();
          username = $('#username').val();
          socket.emit('user join', username);
          console.log(username);
          return false;
        });
        
        $('#message').submit(function(e) {
          e.preventDefault();
          socket.emit('chat message', {
            'message':$('#m').val(),
            'username':'bob',
            'room':room
          });
          $('#m').val('');
          return false;
        });

        $('#group').submit(function(e) {
          e.preventDefault();
          room = $("#g").val();
          password = $('#password').val();
          socket.emit('join room',{
            'room': room,
            'password': password,
            'owner': username
          });
          $("#g").val('');
          return false;
        });

        socket.on('chat message', function(msg) {
          $('#messages').append($('<li>').text(msg.message));
        });

        socket.on('user join', function (username){
          let message = username + " has joined the room";
          $('#messages').append($('<li>').text(message));
        });
        
        $('#delete').click(function(e) {
          e.preventDefault();
          socket.emit('delete room', {
            'room': room
          });
        });

        socket.on('delete room', function() {
          let message = "You have been returned to the default room";
          room = "default";
          $('#messages').append($('<li>').text(message));
            socket.emit('join room',{
            'room': room
          });
        });

      });
    </script>
  </body>
</html>
