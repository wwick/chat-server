<!doctype html>
<html>
  <head>
    <title>Free Food WashU</title>

    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
          font: 12pt Helvetica, Arial;
        }
        #bottom {
          background: #000;
          padding: 3px;
          position: fixed;
          bottom: 0;
          width: 100%;
        }
        input {
          border: 0;
          padding: 10px;
          margin: 10px;
          border: 1px solid black;
        }
        button {
          background: rgb(130, 224, 255);
          border: none; 
          padding: 14px 16px; 
          cursor: pointer;
        }
        label { 
          color:white; 
          padding: 6px
        }
        #messages {
          list-style-type: none;
          margin: 0;
          padding: 0;
        }
        #messages li {
          padding: 5px 10px;
        }
        #messages li:nth-child(odd) {
          background: #eee; 
        }
      </style>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script> 
    <script src="/socket.io/socket.io.js"></script>

  </head>
  <body>

    <ul id="messages"></ul>
    <div id='bottom'>
      <form id='login'>
        <label for="username">Username</label>
        <input type="text" id="username"/><button>Login</button>
      </form>
    </div>

    <script>

      let $input_forms = $("<div>");
      let $owner_forms = $("<div>");

      let $message_form = $("<form>", {id:'message_form'});
      $message_form.append($("<label>", {text: "Chat: ", for: "message"}))
      $message_form.append($("<input>", {type:'text', id:'message'}));
      $message_form.append($("<label>", {text: "User: ", for: "user"}));
      $message_form.append($("<input>", {type:"text", id:"user"}));
      $message_form.append($("<button>", {text:'Enter'}));

      let $room_form = $("<form>", {id:'room_form'});
      $room_form.append($("<label>", {text:'Room Name', for:'room'}));
      $room_form.append($("<input>", {type:'text', id:'room'}));
      $room_form.append($("<label>", {text:'Room Password', for:'password'}));
      $room_form.append($("<input>", {type:'password', id:'password'}));
      $room_form.append($("<button>", {text:'Join/Create Room'}));

      let $kick_form = $("<form>", {id:'kick_form'});
      $kick_form.append($("<label>", {text:"Kick User: ", for: "username"}));
      $kick_form.append($("<input>", {type:'text', id:'username'}));
      $kick_form.append($("<button>", {text:"Kick User"}));

      let $ban_form = $("<form>", {id:'ban_form'});
      $ban_form.append($("<label>", {text:"Ban User: ", for: "ban_user"}));
      $ban_form.append($("<input>", {type:'text', id:'ban_user'}));
      $ban_form.append($("<button>", {text:"Ban User"}));

      let $delete = $("<button>", {id:'delete',text:'Delete Room'});
      
      $input_forms.append($message_form);
      $input_forms.append($room_form);
      $owner_forms.append($kick_form);
      $owner_forms.append($ban_form);
      $owner_forms.append($delete);

      $( "#login" ).submit(function(e) {
        e.preventDefault();
        let username = $( '#username' ).val();
        $( '#username' ).val('');
        if (username != "") {
          login(username);
        }
      });

      function login(username) {
        const socket = io();
        $( '#bottom' ).empty();
        $( '#bottom' ).append($input_forms);
        socket.emit('login', username);

        $( '#message_form' ).submit(function(e) {
          e.preventDefault();
          socket.emit('chat message', {
            'message':$( '#message' ).val(),
            'user':$('#user').val(),
          });
          $( '#message' ).val('');
        });

        $( '#room_form' ).submit(function(e) {
          e.preventDefault();
          let room = $( '#room' ).val();
          let password = $( '#password' ).val();
          socket.emit('join room', {
            'name':room,
            'password':password
          });
          $( '#room' ).val('');
          $( '#password' ).val('');
        });

        $( '#kick_form').submit(function(e) {
          e.preventDefault();
          socket.emit('kick user', {
            'user':$('#username').val()
          });
        });

        $( '#ban_form').submit(function(e) {
          e.preventDefault();
          socket.emit('ban user', {
            'user':$('#ban_user').val()
          });
        });

        $( '#delete' ).click(function(e) {
          e.preventDefault();
            socket.emit('delete room');
        });

        socket.on('message', function(message) {
          $( '#messages' ).append($('<li>').text(message));
        });

        socket.on('delete room', function() {
          let message = "You have been returned to the default room";
          $( '#messages' ).empty();
          $( '#messages' ).append($('<li>').text(message));
          socket.emit('join room', {
            'name':'default',
            'password':''
          });
        });

        socket.on('join room', function(join) {
          if (join.success) {
            $( '#messages' ).empty();
            $( '#owner_forms' ).remove();
            if (join.is_owner) {
              $( '#bottom' ).append($owner_forms);
            }
          }
          $( '#messages' ).append($('<li>').text(join.message));
        });

        socket.on('kicked', function(kicked){
          socket.emit('join room', {
            'name':'default',
            'password':''
          });
          $( '#messages' ).append($('<li>').text(kicked.message));
        });
      }
    </script>
  </body>
</html>
